<script>
	import {onMount, createEventDispatcher} from 'svelte';

	const dispatch = createEventDispatcher();

	export let fontSize = '1rem';

	let sampler;
	let pixelRatio;
	let pixelWidth;
	let pixelHeight;

	let charWidth;
	let charHeight;

	let charsPerLine;
	let linesPerPage;

	let orientation;

	let mounted = false;

	function resizing () {
		if (!mounted) {
			return;
		}
		pixelWidth = screen.width;
		pixelHeight = screen.height;
		charsPerLine = pixelWidth / charWidth;
		linesPerPage = pixelHeight / charHeight;
		orientation = screen.orientation;
		pixelRatio = devicePixelRatio;
		charWidth = sampler?.offsetWidth;
		charHeight = sampler?.offsetHeight;
		console.log(charWidth)
	}

	onMount(() => {
		mounted = true;
		resizing();
		window.addEventListener('resize', resizing);
		return () => {
			window.removeEventListener('resize', resizing);
		}
	})

	$: fontSize, resizing();

	$: dispatch('resize', {
		fontSize,
		charWidth,
		charHeight,
		charsPerLine,
		linesPerPage,
		pixelWidth,
		pixelHeight,
		orientation,
		pixelRatio
	})
</script>

<div>
	<span
		bind:this={sampler}
		bind:offsetWidth={charWidth}
		bind:offsetHeight={charHeight}
		style={`font-size: ${fontSize}`}
	>x</span>
</div>

<style>
	div {
		visibility: hidden;
		width: 0;
		height: 0;
		overflow: hidden;

		background: blue;
		position: fixed;
		top: 0;
		left: 0;
		font-size: 1rem;
	}
</style>