<script context='module'>
	import {writable} from 'svelte/store';

	export const screenGauge = writable();
</script>
<script>
	import {onMount, /* createEventDispatcher */} from 'svelte';

	// TODO Support stores AND events too? Uncomment to restore
	// const dispatch = createEventDispatcher();

	export let fontSize = '1rem';

	let mounted = false;
	let sampler;

	function computeDimensions (sample) {
		const display = {
			width: screen.width,
			height: screen.height,
			orientation: screen.orientation,
			pixelRatio: devicePixelRatio,
		};
		const glyph = {
			width: sample?.offsetWidth,
			height: sample?.offsetHeight,
		}
		const text = {
			width: screen.width / glyph.width,
			height: screen.height / glyph.height,
		}
		return {
			display,
			glyph,
			text,
		};
	}

	function computeFlags (dimensions) {
		return {
			...dimensions,
			size: {
				xSmall: dimensions.text.width < 40,
				small: dimensions.text.width < 60,
				large: dimensions.text.width > 80,
				xLarge: dimensions.text.width > 100,
			},
			orientation: {
				portrait: dimensions.display.orientation === 'portrait',
				landscape: dimensions.display.orientation === 'landscape',
			},
		}
	}

	function resizing () {
		if (!mounted) {
			return;
		}
		const dimensions = computeDimensions(sampler);
		const measures = computeFlags(dimensions);
		screenGauge.set(measures);
		// dispatch('resize', flags); // event support
	}

	onMount(() => {
		mounted = true;
		resizing();
		window.addEventListener('resize', resizing);
		return () => {
			window.removeEventListener('resize', resizing);
		}
	});

	$: fontSize, resizing();
</script>

<div>
	<span
		bind:this={sampler}
		style={`font-size: ${fontSize}`}
	>x</span>
</div>

<style>
	div {
		visibility: hidden;
		width: 0;
		height: 0;
		overflow: hidden;

		background: blue;
		position: fixed;
		top: 0;
		left: 0;
		font-size: 1rem;
	}
</style>