<script>
	import {onMount} from 'svelte';
	import {get} from 'svelte/store';
	import * as _ from 'lamb';
	import {fontFamily, fontScaling, fontVariationSettings} from 'app/stores/fontScaling';


	const fonts = [
		'Archivo',
		'Avenir Next Variable',
		'Noboto Flex',
		'Open Dyslexia'
	];
	const fontSizes = [1.0, 1.25, 0.75];
	const fontVariations = {
		'Archivo': [
			'"wdth" 100',
			'"wdth" 125',
			'"wdth" 80'
		],
		'Avenir Next Variable': [
			'"wdth" 100',
			'"wdth" 75',
			'"wdth" 88'
		],
		'Noboto Flex': [
			'"wght" 180',
			'"wght" 125',
			'"wght" 220'
		],

	};

	const nextFonts = _.make(fonts, _.rotate(fonts, -1));
	const nextSizes = _.make(fontSizes, _.rotate(fontSizes, -1));
	let nextVariations = _.mapValues(
		fontVariations,
		_.pipe([
			_.collect([
				_.identity,
				_.rotateBy(-1)
			]),
			_.apply(_.make)
		])
	);

	let variationsEnabled = true;

	const nextFont = () => {
		const nextFontName = nextFonts[get(fontFamily)] || fonts[0];
		fontFamily.set(nextFontName);
		variationsEnabled = nextFontName in fontVariations;
		fontVariationSettings.set('');
		nextVariation();
	}
	const nextSize = () => {
		const nextFont = nextSizes[get(fontScaling)] || fontSizes[0];
		fontScaling.set(nextFont);
	}
	const nextVariation = () => {
		if (!variationsEnabled) {
			return;
		}
		const fontName = get(fontFamily);

		const nextSettings =  nextVariations[fontName][get(fontVariationSettings)]
			|| fontVariations[fontName][0];
		fontVariationSettings.set(nextSettings);
	}

	onMount( () => {
		nextFont();
	})
</script>

<div>
	<button on:click={nextFont}>Font: {$fontFamily}</button>
	<button on:click={nextSize}>Scale: {$fontScaling}</button>
	<button disabled={!variationsEnabled} on:click={nextVariation}>Settings: {$fontVariationSettings}</button>
</div>
<style>
	div {
		position: fixed;
		top: 5em;
		left: 2em;
		background: white;
		border: thin solid black;
		z-index: 1;
	}
	button {
		display: block;
	}
</style>