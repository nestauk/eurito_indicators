<script>
	import {onMount} from 'svelte';
	import {get} from 'svelte/store';
	import * as _ from 'lamb';
	import {fontFamily, fontScaling, fontVariationSettings} from 'app/stores/fontScaling';


	const fonts = [
		'Archivo',
		'Open Dyslexia'
	];
	const fontSizes = [0.75, 1.0, 1.25];
	const fontVariations = {
		'Archivo': [
			"'wdth' 100",
			"'wdth' 125",
			"'wdth' 80"
		]
	};

	const nextFonts = _.make(fonts, _.rotate(fonts, -1));
	const nextSizes = _.make(fontSizes, _.rotate(fontSizes, -1));
	let nextVariations = _.mapValues(
		fontVariations,
		_.pipe([
			_.collect([
				_.identity,
				_.rotateBy(-1)
			]),
			_.apply(_.make)
		])
	);

	let variationsEnabled = true;

	const nextFont = () => {
		const nextFontName = nextFonts[get(fontFamily)] || fonts[0];
		fontFamily.set(nextFontName);
		variationsEnabled = nextFontName in fontVariations;
	}
	const nextSize = () => {
		const nextFont = nextSizes[get(fontScaling)] || fontSizes[0];
		fontScaling.set(nextFont);
	}
	const nextVariation = () => {
		if (!variationsEnabled) {
			return;
		}
		const fontName = get(fontFamily);

		const nextSettings =  nextVariations[fontName][get(fontVariationSettings)]
			|| fontVariations[fontName][0];
		fontVariationSettings.set(nextSettings);
	}

	onMount( () => {
		nextFont();
		nextSize();
		nextVariation();
	})
</script>

<div>
	<button on:click={nextFont}>font</button>
	<button on:click={nextSize}>size</button>
	<button disabled={!variationsEnabled} on:click={nextVariation}>width</button>
</div>
<style>
	div {
		position: absolute;
		background: white;
		border: thin solid black;
	}
</style>