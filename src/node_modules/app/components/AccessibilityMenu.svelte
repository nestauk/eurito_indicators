<script context='module'>
	import * as _ from 'lamb';
</script>

<script>
	import {writable, get} from 'svelte/store';
	import {a11ySettings} from 'app/stores/a11ySettings';

	// import ColorCorrection from 'app/components/ColorCorrection.svelte';
	import Switch from '@svizzle/ui/src/Switch.svelte';

	// let active = true;
	// const toggleActive = () => active = !active;

	const updateIndexOf = (id, index) => {
		const setting = $a11ySettings[id];
		$a11ySettings = _.merge($a11ySettings, {
			currentValueIndex: index,
			value: setting.values[index]
		});
	};
	const resetIndexOf = id => {
		const setting = $a11ySettings[id];
		$a11ySettings[id] = _.merge(setting, {
			currentValueIndex: setting.defaultValueIndex,
			value: setting.values[setting.defaultValueIndex]
		});
	};
	const updateValueOf = (id, value) => {
		const setting = $a11ySettings[id];
		$a11ySettings[id] = _.merge(setting, {value});
	};
	const resetValueOf = id => {
		const setting = $a11ySettings[id];
		$a11ySettings[id] = _.merge(setting, {
			value: setting.defaultValue
		});
	};

	let currentSetting = $a11ySettings.typeface;
	let currentValue;
	let hasPrev;
	let hasNext;

	const nextSetting = () => currentSetting = $a11ySettings[currentSetting.next];
	const prevSetting = () => currentSetting = $a11ySettings[currentSetting.prev];

	
	$: currentSetting && (currentValue = currentSetting.value);
	$: currentSetting && (hasPrev = currentSetting.prev !== null);
	$: currentSetting && (hasNext = currentSetting.next !== null);
	$: console.log(currentSetting);
</script>

<!-- ColorCorrection options={$colorCorrectionOptions} /-->

<section>
	<header>
		<out class='text'>T</out>
		<out class='color'>C</out>
	</header>
	<menu>
		<label for=''>{currentSetting.label}: {currentSetting.value}</label>
		{#if currentSetting.values}
			<div class='layout-2'>
				{#each currentSetting.values as value, index}
				<div>
					<label for={`input-${index}`}>{value}</label>
					<input 
						name={`input-${index}`}
						type="radio"
						bind:group={currentValue}
						value={index}
					>
				</div>
				{/each}
			</div>
		{:else if currentSetting.range}
			<div class='.layout-2'>
				<input 
					name='hue'
					type='range'
					min={currentSetting.range[0]}
					max={currentSetting.range[1]}
					bind:value={currentValue}>
			</div>
		{:else if currentSetting.format === 'boolean'}
			<Switch
				value={currentValue ? 'No' : 'Yes'}
				values={['No', 'Yes']}
				on:toggled={event => {
					currentValue = event.detail === 'Yes'
				}}
			/>
		{/if}
	</menu>
	<nav>
		<button disabled={!hasPrev} on:click={prevSetting}>&leftarrow;</button>
		<button disabled={!hasNext} on:click={nextSetting}>&rightarrow;</button>
	</nav>
</section>

<style>
	section {
		display: grid;
		width: 100%;
		height: 4.5rem;
		background: white;
		border: thin solid black;
		z-index: 1;
		grid-template-areas: "indicators proppanel nav";
		grid-template-columns: min-content 1fr min-content;
	}
	button {
		display: block;
	}
	header {
		font-family: sans-serif;
		font-size: 16px;
		display: grid;
		grid-template-areas: "upper" "lower";
		grid-template-rows: 50% 50%;
	}
	nav {
		display: grid;
		grid-template-areas: "upper" "lower";
		grid-template-rows: 50% 50%;
	}
	label {
		display: block;
		text-align: center;
	}

	.layout-1, .layout-2 {
		display: grid;
		grid-auto-columns: 1fr;
		grid-auto-flow: column;
		justify-items: center;
		text-align: center;
	}

	.layout-2 {
		grid-template-rows: 1fr;
		align-items: middle;
	}

	button, out {
		width: 2rem;
		height: 2rem;
		box-sizing: border-box;
		text-align: center;
		border: thin solid;
		margin: 0;
	}
</style>
