<script>
	import {onMount} from 'svelte';
	import {get} from 'svelte/store';
	import * as _ from 'lamb';
	import {
		fontFamily, 
		fontScaling, 
		fontVariationSettings,
		letterSpacing,
		wordSpacing,
		lineHeight
	} from 'app/stores/font';

	import {colorCorrectionOptions} from 'app/stores/color';

	const fonts = [
		'Archivo',
		'Avenir Next Variable',
		'Noboto Flex',
		'Open Dyslexia'
	];
	const fontScales = [1.0, 1.25, 0.75];
	const lineHeights = [1.5, 2.0, 1.25];
	const wordSpacings = ['0rem', '0.2rem', '0.4rem'];
	const letterSpacings = ['0rem', '0.1rem', '0.2rem'];
	const fontVariations = {
		'Archivo': [
			'"wdth" 100, "wght" 300',
			'"wdth" 125, "wght" 300',
			'"wdth" 80, "wght" 300'
		],
		'Avenir Next Variable': [
			'"wdth" 100',
			'"wdth" 75',
			'"wdth" 88'
		],
		'Noboto Flex': [
			'"wght" 100',
			'"wght" 150',
			'"wght" 200',
			'"wght" 50',			
		],

	};

	const brightnessLevels = [1, 1.5, 0.5];
	const contrastLevels = [1, 2, 0.5];
	const colorModels = ['normal', 'protanomaly', 'deuteranomaly', 'tritanomaly', 'achromanomaly'];
	const textures = [0, 1];
	const remaps = [0, 1];

	const buildCycler = _.pipe([
		_.collect([
			_.identity,
			_.rotateBy(-1)
		]),
		_.apply(_.make)
	]);

	const nextFonts = buildCycler(fonts);
	const nextSizes = buildCycler(fontScales);
	const nextWordSpacings = buildCycler(wordSpacings);
	const nextLetterSpacings = buildCycler(letterSpacings);
	const nextLineHeights = buildCycler(lineHeights);
	let nextVariations = _.mapValues(fontVariations, buildCycler);

	const nextBrightnesses = buildCycler(brightnessLevels);
	const nextContrasts = buildCycler(contrastLevels);
	const nextColorModels = buildCycler(colorModels);
	const nextTextures = buildCycler(textures);
	const nextRemaps = buildCycler(remaps);

	let variationsEnabled = true;

	const cycleVariation = () => {
		if (!variationsEnabled) {
			return;
		}
		const fontName = get(fontFamily);

		const nextSettings =  nextVariations[fontName][get(fontVariationSettings)]
			|| fontVariations[fontName][0];
		fontVariationSettings.set(nextSettings);
	}
	const cycleFont = () => {
		const nextFontName = nextFonts[get(fontFamily)] || fonts[0];
		fontFamily.set(nextFontName);
		variationsEnabled = nextFontName in fontVariations;
		fontVariationSettings.set('');
		cycleVariation();
	}
	const cycleSize = () => {
		const nextSize = nextSizes[get(fontScaling)] || fontScales[0];
		fontScaling.set(nextSize);
	}
	const cycleLineHeight = () => {
		const nextLineHeight = nextLineHeights[get(lineHeight)] || lineHeights[0];
		lineHeight.set(nextLineHeight);
	}
	const cycleLetterSpacing = () => {
		const nextLetterSpacing = nextLetterSpacings[get(letterSpacing)] || letterSpacings[0];
		letterSpacing.set(nextLetterSpacing);
	}
	const cycleWordSpacing = () => {
		const nextWordSpacing = nextWordSpacings[get(wordSpacing)] || wordSpacings[0];
		wordSpacing.set(nextWordSpacing);
	}

	const cycleBrightness = () => {
		const ccOptions = get(colorCorrectionOptions);
		ccOptions.brightness = nextBrightnesses[ccOptions.brightness] || brightnessLevels[0];
		colorCorrectionOptions.set(ccOptions);
	}
	const cycleContrast = () => {
		const ccOptions = get(colorCorrectionOptions)
		ccOptions.contrast = nextContrasts[ccOptions.contrast] || contrastLevels[0];
		colorCorrectionOptions.set(ccOptions);
	}
	const cycleColorModels = () => {
		const ccOptions = get(colorCorrectionOptions)
		ccOptions.colorVision = nextColorModels[ccOptions.colorVision] || colorModels[0];
		colorCorrectionOptions.set(ccOptions);
	}
	const cycleRemaps = () => {
		const ccOptions = get(colorCorrectionOptions)
		ccOptions.remap = nextRemaps[ccOptions.remap] || remaps[0];
		colorCorrectionOptions.set(ccOptions);
	}
	const cycleTextures = () => {
		const ccOptions = get(colorCorrectionOptions)
		ccOptions.texture = nextTextures[ccOptions.texture] || textures[0];
		colorCorrectionOptions.set(ccOptions);
	}

	onMount( () => {
		cycleFont();
		cycleLineHeight();
		cycleWordSpacing();
		cycleLetterSpacing();
	})
</script>
<div>
	<button on:click={cycleFont}>Font: {$fontFamily}</button>
	<button on:click={cycleSize}>Scale: {$fontScaling}</button>
	<button on:click={cycleLineHeight}>Line height: {$lineHeight}</button>
	<button on:click={cycleLetterSpacing}>Letter spacing: {$letterSpacing}</button>
	<button on:click={cycleWordSpacing}>Word spacing: {$wordSpacing}</button>
	<button disabled={!variationsEnabled} on:click={cycleVariation}>Settings: {$fontVariationSettings}</button>
	<button on:click={cycleColorModels}>Model: {$colorCorrectionOptions.colorVision}</button>
	<button on:click={cycleRemaps}>Remap: {$colorCorrectionOptions.remap}</button>
	<button on:click={cycleTextures}>Texture: {$colorCorrectionOptions.texture}</button>
	<button on:click={cycleBrightness}>Brightness: {$colorCorrectionOptions.brightness}</button>
	<button on:click={cycleContrast}>Contrast: {$colorCorrectionOptions.contrast}</button>

</div>

<style>
	div {
		position: fixed;
		top: 5em;
		left: 2em;
		background: white;
		border: thin solid black;
		z-index: 1;
	}
	button {
		display: block;
	}
</style>