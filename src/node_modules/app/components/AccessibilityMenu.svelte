<script>
	import {onMount} from 'svelte';
	import {get} from 'svelte/store';
	import * as _ from 'lamb';
	import {fontFamily, fontScaling, fontVariationSettings} from 'app/stores/fontScaling';


	const fonts = [
		'Archivo',
		'Avenir Next Variable',
		'Noboto Flex',
		'Open Dyslexia'
	];
	const fontSizes = [1.0, 1.25, 0.75];
	const fontVariations = {
		'Archivo': [
			'"wdth" 100, "wght" 300',
			'"wdth" 125, "wght" 300',
			'"wdth" 80, "wght" 300'
		],
		'Avenir Next Variable': [
			'"wdth" 100',
			'"wdth" 75',
			'"wdth" 88'
		],
		'Noboto Flex': [
			'"wght" 100',
			'"wght" 150',
			'"wght" 200',
			'"wght" 50',			
		],

	};

	const buildCycler = _.pipe([
		_.collect([
			_.identity,
			_.rotateBy(-1)
		]),
		_.apply(_.make)
	]);

	const nextFonts = buildCycler(fonts);
	const nextSizes = buildCycler(fontSizes);
	let nextVariations = _.mapValues(fontVariations, buildCycler);

	let variationsEnabled = true;

	const nextFont = () => {
		const nextFontName = nextFonts[get(fontFamily)] || fonts[0];
		fontFamily.set(nextFontName);
		variationsEnabled = nextFontName in fontVariations;
		fontVariationSettings.set('');
		nextVariation();
	}
	const nextSize = () => {
		const nextFont = nextSizes[get(fontScaling)] || fontSizes[0];
		fontScaling.set(nextFont);
	}
	const nextVariation = () => {
		if (!variationsEnabled) {
			return;
		}
		const fontName = get(fontFamily);

		const nextSettings =  nextVariations[fontName][get(fontVariationSettings)]
			|| fontVariations[fontName][0];
		fontVariationSettings.set(nextSettings);
	}

	onMount( () => {
		nextFont();
	})
</script>

<div>
	<button on:click={nextFont}>Font: {$fontFamily}</button>
	<button on:click={nextSize}>Scale: {$fontScaling}</button>
	<button disabled={!variationsEnabled} on:click={nextVariation}>Settings: {$fontVariationSettings}</button>
</div>
<style>
	div {
		position: fixed;
		top: 5em;
		left: 2em;
		background: white;
		border: thin solid black;
		z-index: 1;
	}
	button {
		display: block;
	}
</style>