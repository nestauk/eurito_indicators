import * as _ from 'lamb';

export const testResultsURL = 'https://gist.githubusercontent.com/NestaTestUser/8fb890ee1ebf84435539faa7996b140e/raw/Browserstack%20test%20results%20for%20Eurito%20Indicators%20webapp';

const osMap = {
	'Windows': 'Windows',
	'macOS': 'OS X'
};
const browserMap = {
	'Microsoft Edge': 'Edge',
	'Chrome': 'Chrome',
	'Safari': 'Safari',
	'Firefox': 'Firefox'
};

const getOS = _.getPath('capabilities.bstack:options.os');
const getVersion = _.getPath('capabilities.bstack:options.osVersion');
const getBrowser = _.getPath('capabilities.browserName');
const getBrowserV = _.getPath('capabilities.browserVersion');

export const groupTests = _.pipe([
	_.groupBy(getOS),
	_.mapValuesWith(_.pipe([
		_.groupBy(getVersion),
		_.mapValuesWith(_.pipe([
			_.groupBy(getBrowser),
			_.mapValuesWith(_.pipe([
				_.groupBy(getBrowserV),
			])),
		])),
	])),
]);

export const getTest = (index, env) => {
	const os = osMap[env.os.name];
	const osVersion = env.os.versionName;
	const browser = browserMap[env.browser.name];
	const browserVersion = env.browser.version.split('.').slice(0,2).join('.');
	return index[os][osVersion][browser][browserVersion];
};
